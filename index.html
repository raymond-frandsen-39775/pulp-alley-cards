<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Pulp Alley Fortune Card Lookup</title>
<link rel="icon" href="data:;base64,iVBORw0KGgo=">
  <style>
  :root{
    --bg:#cdbd98;
    --bg-top:#cdbd98;
    --bg-bottom:#e6d8bd;
    --ink:#2d2010;
    --brown:#6f5b33;
    --paper:#f6edd9;
    --paper-dots:#eadfca;
    --line:#ab9472;
    --shadow:rgba(0,0,0,.35);
  }
  html,body{height:100%;}
  body{
    margin:0;
    font-family:Georgia,"Times New Roman",serif;
    color:var(--ink);
    background:
      radial-gradient(ellipse at center, rgba(0,0,0,.07), rgba(0,0,0,0) 70%) 50% -120px/120% 260px no-repeat,
      linear-gradient(var(--bg-top),var(--bg-bottom));
  }
  .wrap{max-width:1100px;margin:26px auto 96px;padding:0 16px;text-align:center;}
  h1{
    font-family:"Copperplate",Georgia,serif;
    font-size:34px;
    margin:0 0 14px;
    letter-spacing:.4px;
    text-shadow:0 1px 0 #fff8;
  }
  .bar{
    display:flex;gap:10px;justify-content:center;align-items:center;margin:8px 0 18px;flex-wrap:wrap;
  }
  input[type="search"]{
    width:60%;min-width:300px;padding:12px 12px;font-size:16px;border:1px solid #b9a37f;border-radius:6px;background:#fff;box-shadow:inset 0 1px 2px rgba(0,0,0,.08);
  }
  button{
    padding:10px 14px;font-size:16px;cursor:pointer;border:1px solid #b9a37f;border-radius:6px;background:#efe4ca;box-shadow:0 1px 0 #fff inset,0 1px 2px rgba(0,0,0,.08);
  }
  #results{
    max-width:760px;margin:18px auto 0;padding:0 0 40px;
  }

  /* Card shell */
  .card{
    width:540px;max-width:92%;
    margin:22px auto;
    position:relative;
    background:
      radial-gradient(circle at 20px 20px, rgba(0,0,0,.08), transparent 22px) top left/100% 100% no-repeat,
      radial-gradient(circle at calc(100% - 20px) 20px, rgba(0,0,0,.08), transparent 22px) top right/100% 100% no-repeat,
      radial-gradient(circle at 20px calc(100% - 20px), rgba(0,0,0,.08), transparent 22px) bottom left/100% 100% no-repeat,
      radial-gradient(circle at calc(100% - 20px) calc(100% - 20px), rgba(0,0,0,.08), transparent 22px) bottom right/100% 100% no-repeat,
      radial-gradient(#efeadb 1.5px, transparent 1.6px) 0 0/6px 6px,
      linear-gradient(#f7efdc,#efe4ca);
    border-radius:10px;
    border:1px solid #c0ad88;
    box-shadow:0 10px 26px var(--shadow), 0 1px 0 #fff inset;
    padding:22px 22px 14px;
  }
  /* tiny rounded-corner “nicks” */
  .card::before, .card::after{
    content:"";position:absolute;width:22px;height:22px;background:linear-gradient(135deg, #9b7e55 0 50%, transparent 51%);bottom:0;left:0;border-bottom-left-radius:6px;opacity:.9;
    clip-path:polygon(0 0,100% 0,0 100%);
  }
  .card::after{left:auto;right:0;transform:scaleX(-1);}

  .title{
    text-align:center;font-size:22px;margin:0 0 10px;font-weight:700;text-shadow:0 1px 0 #fff7;
  }

  .addBtn{
    position:absolute;top:8px;right:10px;
    font-size:12px;background:#f6edd9;border:1px solid #b9a37f;border-radius:12px;padding:5px 8px;box-shadow:0 1px 0 #fff inset,0 1px 2px rgba(0,0,0,.1);cursor:pointer;
  }

  .line{height:1px;background:linear-gradient(90deg, transparent 0 6%, #b2996e 6% 94%, transparent 94%);margin:10px 0;}

  .play, .effect, .flavor, .challengeBlk{ text-align:center; }
  .play b, .effect b{ font-weight:700; }
  .flavor{ font-style:italic; margin:6px 0 4px; opacity:.9; }

  .icons{
    display:flex;justify-content:center;gap:8px;margin:10px 0 8px;
  }
  .skull{ width:20px;height:20px; }

  .challengeBlk .label{ display:block; font-weight:700; margin-top:6px; }
  .subtle{ opacity:.85; }

  .footer{
    display:flex;justify-content:space-between;align-items:center;margin-top:8px;
  }
  .coin{ width:30px;height:30px;border-radius:50%;background:#efe3c3;border:1px solid #b79a6a;display:flex;align-items:center;justify-content:center;box-shadow:0 1px 0 #fff inset,0 1px 2px rgba(0,0,0,.15);font-weight:700; }
  .lock{ width:28px;height:28px;opacity:.9; }

  /* Copyright badge */
  .copyright{
    position:fixed;top:8px;left:12px;font-size:12px;color:var(--ink);
    background:rgba(255,255,255,.6);padding:6px 10px;border-radius:4px;line-height:1.35;z-index:1000;
    box-shadow:0 2px 4px rgba(0,0,0,.25);
  }
</style>
</head>
<body>
  <div class="copyright">
    App Copyright 2025 - Ray Frandsen<br>
    Cards Copyright 2025 - Pulp Alley
  </div>

  <div class="wrap">
    <h1>Pulp Alley Fortune Card Lookup</h1>
    <div class="bar">
      <input id="q" type="search" placeholder="Search by ID or Name..." />
      <button id="btnSearch" type="button">Search</button>
    </div>

    <div id="results">Type a query and click Search…</div>
  </div>
  
  <!-- Sticky hand header + grid -->
  <div class="handHeader">
    <div class="handTitle">Hand: <span id="handCount">0</span></div>
    <div class="handControls">
      <button id="btnClearHand">Clear Hand</button>
    </div>
  </div>
  <div id="hand" class="handGrid"></div>

  <!-- Confirm modal -->
  <div id="confirm" class="modal" role="dialog" aria-modal="true" aria-labelledby="confirmTitle">
    <div class="modalBox">
      <h3 id="confirmTitle" class="modalTitle">Remove card?</h3>
      <p class="modalMsg">This card will be removed from your hand.</p>
      <div class="modalBtns">
        <button id="confirmYes" class="btnDanger">Remove</button>
        <button id="confirmNo">Cancel</button>
      </div>
    </div>
  </div>
<script>
  // ---------- CONFIG ----------
  const GAS_URL = 'https://script.google.com/macros/s/AKfycbxzfKR_CuPgnn6XNWympqPeMWWcG-zBj7XMPLjFjag5vBtbpgW7gUfpV3ON-vYlUas9lg/exec';
    /* Corner ornament */
    function ornSvg(){
      return '<svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg"><path fill="#4c2b16" d="M0,0 L64,0 L64,8 C44,8 20,24 8,40 L0,40 Z" opacity=".85"/></svg>';
    }

    /* Divider (three skull tiles + spear) */
    function skullDividerSepia(){
      return '<svg viewBox="0 0 300 36" xmlns="http://www.w3.org/2000/svg">'
        + '<g stroke="#3c2a1a" stroke-width="2" stroke-linecap="round" fill="none">'
        + '<path d="M8 18 H95"/><path d="M205 18 H292"/></g>'
        + '<rect x="110" y="6" width="24" height="24" fill="#2b1a10" stroke="#3c2a1a"/>'
        + '<rect x="138" y="6" width="24" height="24" fill="#2b1a10" stroke="#3c2a1a"/>'
        + '<rect x="166" y="6" width="24" height="24" fill="#2b1a10" stroke="#3c2a1a"/>'
        + '<defs><g id="s"><path d="M12,5 c5,0 9,3.5 9,8 c0,3 -1.5,4.5 -3.5,5.4 v2.2 h-11 v-2.2 C4.5,17.5 3,16 3,13 C3,8.5 7,5 12,5 z" fill="#f7f2e3" stroke="#3c2a1a" stroke-width="0.75"/>'
        + '<ellipse cx="9" cy="12" rx="2" ry="2.8" fill="#3c2a1a"/><ellipse cx="15" cy="12" rx="2" ry="2.8" fill="#3c2a1a"/>'
        + '<path d="M12 14 l-1.5 2.2 h3 z" fill="#3c2a1a"/><rect x="8" y="19.2" width="8" height="3.2" rx="0.8" fill="#3c2a1a"/></g></defs>'
        + '<use href="#s" x="110" y="6"/><use href="#s" x="138" y="6"/><use href="#s" x="166" y="6"/></svg>';
    }

    /* Inline SVG Icon Set (includes enamel coin variants) */
    function iconSVG(name){
      const key = String(name||'').trim().toLowerCase();
      const uid = Math.random().toString(36).slice(2, 8); // unique per call

      switch (key) {
        case 'gear':
          return '<svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg"><g fill="currentColor">'
               + '<path d="M28 6h8l2 6 6 2 6-2 4 7-5 4 1 6 5 4-4 7-6-2-6 2-2 6h-8l-2-6-6-2-6 2-4-7 5-4-1-6-5-4 4-7 6 2 6-2 2-6z"/>'
               + '<circle cx="32" cy="32" r="10" fill="#fff" fill-opacity=".15"/></g></svg>';

        case 'star':
          return '<svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg"><path fill="currentColor" d="M32 6l7.5 15.2 16.8 2.4-12.1 11.8 2.9 16.7L32 44.6 16.9 52.9l2.9-16.7L7.7 23.6 24.5 21z"/></svg>';

        case 'skull':
          return '<svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg">'
               + '<path d="M32 10c9 0 16 6.8 16 15.2 0 5.7-3 8.6-6.8 10.3V40H22.8v-4.5C19 34 16 31 16 25.2 16 16.8 23 10 32 10z" fill="currentColor"/>'
               + '<ellipse cx="26" cy="26" rx="3.5" ry="4.5" fill="#fff" fill-opacity=".1"/>'
               + '<ellipse cx="38" cy="26" rx="3.5" ry="4.5" fill="#fff" fill-opacity=".1"/>'
               + '<path d="M28 30l-2.2 3.2h4.4zM24 36h16v3H24z" fill="#fff" fill-opacity=".15"/></svg>';

        case 'bolt':
          return '<svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg"><path fill="currentColor" d="M38 6 14 36h14l-2 22 26-32H38z"/></svg>';

        case 'book':
          return '<svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg">'
               + '<path d="M10 14c8-3 12-3 20 0v36c-8-3-12-3-20 0V14z" fill="currentColor"/>'
               + '<path d="M54 14c-8-3-12-3-20 0v36c8-3 12-3 20 0V14z" fill="currentColor"/>'
               + '<path d="M30 50c-6-2-10-2-16 0M50 50c-6-2-10-2-16 0" stroke="#fff" stroke-width="2" opacity=".25" fill="none"/></svg>';

        /* “Coin” enamel styles for right badge */
        case 'glass': {
          const gBronze = `gBronzeMag_${uid}`, gEnamel = `gEnamelMag_${uid}`;
          return ''+
            '<svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">'+
            '  <defs>'+
            `    <radialGradient id="${gBronze}" cx="30%" cy="25%" r="80%"><stop offset="0%" stop-color="#e7bf97"/><stop offset="50%" stop-color="#b68459"/><stop offset="100%" stop-color="#744f33"/></radialGradient>`+
            `    <radialGradient id="${gEnamel}" cx="35%" cy="30%" r="75%"><stop offset="0%" stop-color="#ffffff"/><stop offset="100%" stop-color="#f4efe6"/></radialGradient>`+
            '  </defs>'+
            `  <circle cx="32" cy="32" r="31" fill="url(#${gBronze})" />`+
            `  <circle cx="32" cy="32" r="29" fill="url(#${gEnamel})" stroke="#c1b092" stroke-width="1"/>`+
            '  <g stroke="#3c2a1a" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" fill="none">'+
            '    <circle cx="28" cy="28" r="10" />'+
            '    <line x1="35" y1="35" x2="46" y2="46" />'+
            '  </g>'+
            '</svg>';
        }

        case 'lock': {
          const gBronze = `gBronzeLock_${uid}`, gEnamel = `gEnamelLock_${uid}`;
          return ''+
            '<svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">'+
            '  <defs>'+
            `    <radialGradient id="${gBronze}" cx="30%" cy="25%" r="80%"><stop offset="0%" stop-color="#e7bf97"/><stop offset="50%" stop-color="#b68459"/><stop offset="100%" stop-color="#744f33"/></radialGradient>`+
            `    <radialGradient id="${gEnamel}" cx="35%" cy="30%" r="75%"><stop offset="0%" stop-color="#ffffff"/><stop offset="100%" stop-color="#f4efe6"/></radialGradient>`+
            '  </defs>'+
            `  <circle cx="32" cy="32" r="31" fill="url(#${gBronze})" />`+
            `  <circle cx="32" cy="32" r="29" fill="url(#${gEnamel})" stroke="#c1b092" stroke-width="1"/>`+
            '  <g stroke="#3c2a1a" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" fill="none">'+
            '    <path d="M24 30 v-6 a8 8 0 0 1 16 0 v6" />'+
            '    <rect x="22" y="30" width="20" height="16" rx="2" ry="2" fill="#3c2a1a" />'+
            '    <circle cx="32" cy="38" r="2" fill="#f4efe6" stroke="none"/>'+
            '    <line x1="32" y1="40" x2="32" y2="44" stroke="#f4efe6" stroke-width="2"/>'+
            '  </g>'+
            '</svg>';
        }

        default: return '';
      }
    }
  // ---------- JSONP helper ----------
  function jsonp(url){
    return new Promise((resolve,reject)=>{
      const cb='cb_'+Math.random().toString(36).slice(2);
      const s=document.createElement('script');
      window[cb]=(data)=>{ resolve(data); delete window[cb]; s.remove(); };
      s.onerror=(ev)=>{ console.error('JSONP failed for', s.src); reject(new Error('JSONP request failed')); delete window[cb]; s.remove(); };
      s.src=url+(url.includes('?')?'&':'?')+'callback='+cb;
      document.body.appendChild(s);
    });
  }

  // ---------- RENDER ----------
  function render(payload){
    const headers = payload.headers||[];
    const rows = payload.rows||[];
    const res = document.getElementById('results');
    if(!rows.length){ res.innerHTML='<p>No cards found.</p>'; return; }
    const objs = rows.map(r=>{ const o={}; headers.forEach((h,i)=>o[h]=r[i]); return o; });
    res.innerHTML = objs.map(o=> cardHTML(o)).join('');
  }

  // ---------- CARD ----------
    function cardHTML(o, opts={}){
      const showAdd = !!opts.showAdd;
      const icon = iconSVG(o.Icon||'');
      return `
        <div class="card">
          <div class="corner tl">${ornSvg()}</div>
          <div class="corner tr">${ornSvg()}</div>
          <div class="corner br">${ornSvg()}</div>
          <div class="corner bl">${ornSvg()}</div>

          <div class="title">${escapeHtml(o.Name||'')}</div>

          <div class="row"><span class="label">Type:</span> ${escapeHtml(o.Type||'')}</div>
          <div class="divider">${skullDividerSepia()}</div>
          <div class="challengeHdr">${escapeHtml(o.Challenge||'')}</div>
          <div class="skills">${escapeHtml(o.Skills||'')}</div>
          ${o.Flavor ? `<div class="flavor">“${escapeHtml(o.Flavor)}”</div>` : ''}

          <div class="badge left">${escapeHtml((o.ID||'').toString())}</div>
          <div class="badge right">${icon||''}</div>

          <div class="footer">${escapeHtml(o.Notes||'')}</div>

          ${showAdd ? `<div class="actions"><button class="btn-add" data-id="${escapeAttr(o.ID)}">Add to Hand</button></div>` : ``}
        </div>
      `;
    }

  // ---------- SVG bits ----------
  function skullSVG(){
    return `<svg class="skull" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
      <path fill="#5b4a2a" d="M12 3c4.2 0 7.5 2.9 7.5 6.9 0 2.6-1.4 4.7-3.7 5.9v2.2c0 .6-.5 1-1 1h-1.2c-.6 0-1-.5-1-1v-1h-1.2v1c0 .6-.4 1-1 1H9.2c-.6 0-1-.5-1-1v-2.2C6 14.6 4.5 12.5 4.5 9.9 4.5 5.9 7.8 3 12 3z"/>
      <circle cx="9" cy="10" r="1.7" fill="#f6edd9"/>
      <circle cx="15" cy="10" r="1.7" fill="#f6edd9"/>
      <rect x="10.6" y="13.2" width="2.8" height="1.6" rx=".8" fill="#f6edd9"/>
    </svg>`;
  }
  function lockSVG(){
    return `<svg class="lock" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
      <rect x="6" y="10" width="12" height="10" rx="2" fill="#c5b089" stroke="#8e744e"/>
      <path d="M8.5 10V8.2C8.5 6 10.4 4.2 12.6 4.2s4.1 1.8 4.1 4V10" fill="none" stroke="#8e744e" stroke-width="1.4"/>
      <circle cx="12" cy="15" r="1.3" fill="#8e744e"/>
    </svg>`;
  }

  // ---------- SEARCH ----------
  async function doSearch(){
    const q = document.getElementById('q').value.trim();
    const res = document.getElementById('results');
    if(!q){ res.innerHTML='<p>Please enter a search term.</p>'; return; }
    res.innerHTML='<p><em>Searching…</em></p>';
    try{
      const url = `${GAS_URL}?mode=json&q=${encodeURIComponent(q)}&page=1&_=${Date.now()}`;
      const payload = await jsonp(url);
      // normalize if backend returns object arrays
      if (!Array.isArray(payload.headers) || !Array.isArray(payload.rows)) {
        const list = Array.isArray(payload?.data) ? payload.data : [];
        const headers = list.length ? Object.keys(list[0]) : [];
        const rows = list.map(o => headers.map(h => o[h] ?? ''));
        render({headers,rows});
      } else {
        render(payload);
      }
    } catch(e){
      console.error(e);
      res.innerHTML = `<p style="color:#900;">Search failed: ${escapeHTML(e.message)}</p>`;
    }
  }
  document.getElementById('btnSearch').onclick=doSearch;
  document.getElementById('q').addEventListener('keydown',e=>{ if(e.key==='Enter') doSearch(); });

  // ---------- helpers ----------
  function escapeHTML(s){return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#39;');}
  function safe(v){return v==null?'':String(v);}
</script>
</body>
</html>
