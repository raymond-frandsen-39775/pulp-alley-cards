<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Pulp Alley Fortune Card Lookup</title>
<link rel="icon" href="data:;base64,iVBORw0KGgo=">
<style>
  :root{
    --bg:#cdbd98;
    --bg-top:#cdbd98;
    --bg-bottom:#e6d8bd;
    --ink:#2d2010;
    --brown:#6f5b33;
    --paper:#f6edd9;
    --paper-dots:#eadfca;
    --line:#ab9472;
    --shadow:rgba(0,0,0,.35);
  }
  html,body{height:100%;}
  body{
    margin:0;
    font-family:Georgia,"Times New Roman",serif;
    color:var(--ink);
    background:
      radial-gradient(ellipse at center, rgba(0,0,0,.07), rgba(0,0,0,0) 70%) 50% -120px/120% 260px no-repeat,
      linear-gradient(var(--bg-top),var(--bg-bottom));
  }
  .wrap{max-width:1100px;margin:26px auto 96px;padding:0 16px;text-align:center;}
  h1{
    font-family:"Copperplate",Georgia,serif;
    font-size:34px;
    margin:0 0 14px;
    letter-spacing:.4px;
    text-shadow:0 1px 0 #fff8;
  }
  .bar{
    display:flex;gap:10px;justify-content:center;align-items:center;margin:8px 0 18px;flex-wrap:wrap;
  }
  input[type="search"]{
    width:60%;min-width:300px;padding:12px 12px;font-size:16px;border:1px solid #b9a37f;border-radius:6px;background:#fff;box-shadow:inset 0 1px 2px rgba(0,0,0,.08);
  }
  button{
    padding:10px 14px;font-size:16px;cursor:pointer;border:1px solid #b9a37f;border-radius:6px;background:#efe4ca;box-shadow:0 1px 0 #fff inset,0 1px 2px rgba(0,0,0,.08);
  }
  #results{
    max-width:760px;margin:18px auto 0;padding:0 0 40px;
  }

  /* Card shell */
  .card{
    width:540px;max-width:92%;
    margin:22px auto;
    position:relative;
    background:
      radial-gradient(circle at 20px 20px, rgba(0,0,0,.08), transparent 22px) top left/100% 100% no-repeat,
      radial-gradient(circle at calc(100% - 20px) 20px, rgba(0,0,0,.08), transparent 22px) top right/100% 100% no-repeat,
      radial-gradient(circle at 20px calc(100% - 20px), rgba(0,0,0,.08), transparent 22px) bottom left/100% 100% no-repeat,
      radial-gradient(circle at calc(100% - 20px) calc(100% - 20px), rgba(0,0,0,.08), transparent 22px) bottom right/100% 100% no-repeat,
      radial-gradient(#efeadb 1.5px, transparent 1.6px) 0 0/6px 6px,
      linear-gradient(#f7efdc,#efe4ca);
    border-radius:10px;
    border:1px solid #c0ad88;
    box-shadow:0 10px 26px var(--shadow), 0 1px 0 #fff inset;
    padding:22px 22px 14px;
  }
  /* tiny rounded-corner “nicks” */
  .card::before, .card::after{
    content:"";position:absolute;width:22px;height:22px;background:linear-gradient(135deg, #9b7e55 0 50%, transparent 51%);bottom:0;left:0;border-bottom-left-radius:6px;opacity:.9;
    clip-path:polygon(0 0,100% 0,0 100%);
  }
  .card::after{left:auto;right:0;transform:scaleX(-1);}

  .title{
    text-align:center;font-size:22px;margin:0 0 10px;font-weight:700;text-shadow:0 1px 0 #fff7;
  }

  .addBtn{
    position:absolute;top:8px;right:10px;
    font-size:12px;background:#f6edd9;border:1px solid #b9a37f;border-radius:12px;padding:5px 8px;box-shadow:0 1px 0 #fff inset,0 1px 2px rgba(0,0,0,.1);cursor:pointer;
  }

  .line{height:1px;background:linear-gradient(90deg, transparent 0 6%, #b2996e 6% 94%, transparent 94%);margin:10px 0;}

  .play, .effect, .flavor, .challengeBlk{ text-align:center; }
  .play b, .effect b{ font-weight:700; }
  .flavor{ font-style:italic; margin:6px 0 4px; opacity:.9; }

  .icons{
    display:flex;justify-content:center;gap:8px;margin:10px 0 8px;
  }
  .skull{ width:20px;height:20px; }

  .challengeBlk .label{ display:block; font-weight:700; margin-top:6px; }
  .subtle{ opacity:.85; }

  .footer{
    display:flex;justify-content:space-between;align-items:center;margin-top:8px;
  }
  .coin{ width:30px;height:30px;border-radius:50%;background:#efe3c3;border:1px solid #b79a6a;display:flex;align-items:center;justify-content:center;box-shadow:0 1px 0 #fff inset,0 1px 2px rgba(0,0,0,.15);font-weight:700; }
  .lock{ width:28px;height:28px;opacity:.9; }

  /* Copyright badge */
  .copyright{
    position:fixed;top:8px;left:12px;font-size:12px;color:var(--ink);
    background:rgba(255,255,255,.6);padding:6px 10px;border-radius:4px;line-height:1.35;z-index:1000;
    box-shadow:0 2px 4px rgba(0,0,0,.25);
  }
</style>
</head>
<body>
  <div class="copyright">
    App Copyright 2025 - Ray Frandsen<br>
    Cards Copyright 2025 - Pulp Alley
  </div>

  <div class="wrap">
    <h1>Pulp Alley Fortune Card Lookup</h1>
    <div class="bar">
      <input id="q" type="search" placeholder="Lucky" />
      <button id="btnSearch" type="button">Search</button>
    </div>

    <div id="results">Type a query and click Search…</div>
  </div>

<script>
  // ---------- CONFIG ----------
  const GAS_URL = 'https://script.google.com/macros/s/AKfycbxzfKR_CuPgnn6XNWympqPeMWWcG-zBj7XMPLjFjag5vBtbpgW7gUfpV3ON-vYlUas9lg';

  // ---------- JSONP helper ----------
  function jsonp(url){
    return new Promise((resolve,reject)=>{
      const cb='cb_'+Math.random().toString(36).slice(2);
      const s=document.createElement('script');
      window[cb]=(data)=>{ resolve(data); delete window[cb]; s.remove(); };
      s.onerror=(ev)=>{ console.error('JSONP failed for', s.src); reject(new Error('JSONP request failed')); delete window[cb]; s.remove(); };
      s.src=url+(url.includes('?')?'&':'?')+'callback='+cb;
      document.body.appendChild(s);
    });
  }

  // ---------- RENDER ----------
  function render(payload){
    const headers = payload.headers||[];
    const rows = payload.rows||[];
    const res = document.getElementById('results');
    if(!rows.length){ res.innerHTML='<p>No cards found.</p>'; return; }
    const objs = rows.map(r=>{ const o={}; headers.forEach((h,i)=>o[h]=r[i]); return o; });
    res.innerHTML = objs.map(o=> cardHTML(o)).join('');
  }

  // ---------- CARD ----------
  function cardHTML(o){
    const name   = safe(o.Name);
    const id     = safe(o.ID);
    const play   = safe(o.Play);
    const effect = safe(o.Effect);
    const flavor = safe(o.Flavor);
    const skills = safe(o.Skills);
    const chall  = safe(o.ChallengeValue);
    const limit  = safe(o.CardLimit);

    return `
      <div class="card">
        <button class="addBtn" onclick="alert('Added to hand: ${escapeHTML(name||('Card '+id))}')">+ Add to hand</button>
        <h2 class="title">${escapeHTML(name||('Card '+id))}</h2>

        ${play? `<p class="play"><b>Play:</b> ${escapeHTML(play)}</p>`:''}
        ${effect? `<p class="effect"><b>Effect:</b> ${escapeHTML(effect)}</p>`:''}
        ${flavor? `<p class="flavor">“${escapeHTML(flavor)}”</p>`:''}

        <div class="line"></div>

        <div class="icons">
          ${skullSVG()}${skullSVG()}${skullSVG()}${skullSVG()}
        </div>

        <div class="line"></div>

        <div class="challengeBlk">
          <span class="label">Challenge</span>
          <div class="subtle">${escapeHTML(skills)}</div>
        </div>

        <div class="footer">
          <div class="coin">${escapeHTML(limit||'1')}</div>
          <div class="subtle">#${escapeHTML(id||'')}/<span>${escapeHTML(limit||'2')}</span> · Pulp Alley © 2025</div>
          ${lockSVG()}
        </div>
      </div>
    `;
  }

  // ---------- SVG bits ----------
  function skullSVG(){
    return `<svg class="skull" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
      <path fill="#5b4a2a" d="M12 3c4.2 0 7.5 2.9 7.5 6.9 0 2.6-1.4 4.7-3.7 5.9v2.2c0 .6-.5 1-1 1h-1.2c-.6 0-1-.5-1-1v-1h-1.2v1c0 .6-.4 1-1 1H9.2c-.6 0-1-.5-1-1v-2.2C6 14.6 4.5 12.5 4.5 9.9 4.5 5.9 7.8 3 12 3z"/>
      <circle cx="9" cy="10" r="1.7" fill="#f6edd9"/>
      <circle cx="15" cy="10" r="1.7" fill="#f6edd9"/>
      <rect x="10.6" y="13.2" width="2.8" height="1.6" rx=".8" fill="#f6edd9"/>
    </svg>`;
  }
  function lockSVG(){
    return `<svg class="lock" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
      <rect x="6" y="10" width="12" height="10" rx="2" fill="#c5b089" stroke="#8e744e"/>
      <path d="M8.5 10V8.2C8.5 6 10.4 4.2 12.6 4.2s4.1 1.8 4.1 4V10" fill="none" stroke="#8e744e" stroke-width="1.4"/>
      <circle cx="12" cy="15" r="1.3" fill="#8e744e"/>
    </svg>`;
  }

  // ---------- SEARCH ----------
  async function doSearch(){
    const q = document.getElementById('q').value.trim();
    const res = document.getElementById('results');
    if(!q){ res.innerHTML='<p>Please enter a search term.</p>'; return; }
    res.innerHTML='<p><em>Searching…</em></p>';
    try{
      const url = `${GAS_URL}?mode=json&q=${encodeURIComponent(q)}&page=1&_=${Date.now()}`;
      const payload = await jsonp(url);
      // normalize if backend returns object arrays
      if (!Array.isArray(payload.headers) || !Array.isArray(payload.rows)) {
        const list = Array.isArray(payload?.data) ? payload.data : [];
        const headers = list.length ? Object.keys(list[0]) : [];
        const rows = list.map(o => headers.map(h => o[h] ?? ''));
        render({headers,rows});
      } else {
        render(payload);
      }
    } catch(e){
      console.error(e);
      res.innerHTML = `<p style="color:#900;">Search failed: ${escapeHTML(e.message)}</p>`;
    }
  }
  document.getElementById('btnSearch').onclick=doSearch;
  document.getElementById('q').addEventListener('keydown',e=>{ if(e.key==='Enter') doSearch(); });

  // ---------- helpers ----------
  function escapeHTML(s){return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#39;');}
  function safe(v){return v==null?'':String(v);}
</script>
</body>
</html>
