<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Pulp Alley Card Lookup</title>

  <style>
    /* --- Page + Typography --- */
    body { background:#d6c5a0; margin:0; font-family:Georgia,"Times New Roman",serif; }
    .wrap { max-width:1100px; margin:24px auto; padding:0 16px 96px; text-align:center; }
    h1 { font-family:"Copperplate",Georgia,serif; font-size:26px; margin:0 0 12px; }
    .bar { display:flex; gap:8px; justify-content:center; margin-bottom:16px; }
    input[type="search"]{ width:60%; min-width:280px; padding:10px 12px; font-size:16px; border:1px solid #b9a37f; border-radius:6px; }
    button{ padding:10px 14px; font-size:16px; cursor:pointer; border:1px solid #b9a37f; border-radius:6px; background:#f6edd9; }

    /* --- Cards Grid --- */
    .cards{ display:flex; flex-wrap:wrap; gap:16px; justify-content:center; }

    /* --- Card --- */
    .card{
      width:300px; position:relative; text-align:left; color:#1a0f08;
      background:#f8f0db; border:2px solid #4c2b16; border-radius:8px;
      box-shadow:0 4px 10px rgba(0,0,0,.35); padding:14px 16px 44px;
    }
    .card:before{
      content:""; position:absolute; inset:0; pointer-events:none; border-radius:6px;
      background-image: radial-gradient(#f6e9c6 1px,transparent 1px), radial-gradient(#f6e9c6 1px,transparent 1px);
      background-position:0 0,10px 10px; background-size:20px 20px; opacity:.45; z-index:0;
    }

    /* --- Corner ornaments --- */
    .corner{ position:absolute; width:28px; height:28px; opacity:.9; }
    .corner.tl{ left:-2px; top:-2px; }
    .corner.tr{ right:-2px; top:-2px; transform:rotate(90deg); }
    .corner.br{ right:-2px; bottom:-2px; transform:rotate(180deg); }
    .corner.bl{ left:-2px; bottom:-2px; transform:rotate(270deg); }

    /* --- Card text blocks --- */
    .title{ position:relative; z-index:1; font-family:"Copperplate",Georgia,serif; text-align:center; font-size:22px; font-weight:900; margin:2px 0 8px; }
    .row{ position:relative; z-index:1; margin:6px 0; }
    .label{ font-weight:900; }
    .flavor{ position:relative; z-index:1; text-align:center; font-style:italic; margin:10px 0 6px; }

    /* --- Divider --- */
    .divider{ display:flex; justify-content:center; align-items:center; margin:10px 0; }
    .divider svg{ width:100%; height:auto; max-width:calc(300px - 24px); display:block; }

    /* --- Challenge / Skills --- */
    .challengeHdr{ position:relative; z-index:1; text-align:center; font-weight:900; font-size:18px; margin:2px 0; }
    .skills{ position:relative; z-index:1; text-align:center; font-weight:700; font-size:16px; margin-top:2px; }

    /* --- Badges --- */
    .badge{
      position:absolute; bottom:6px; width:40px; height:40px; border-radius:50%;
      background:#e9ddc1; border:2px solid #9d8a62; display:flex; align-items:center; justify-content:center;
      font-weight:900; color:#22150c; box-shadow:0 2px 4px rgba(0,0,0,.25); z-index:2;
    }
    .badge.left{ left:8px; }

    /* Right badge uses inline SVG enamel coin */
    .badge.right{
      right:8px;
      width:40px; height:40px; border-radius:50%;
      border:2px solid #9d8a62;
      overflow:hidden; display:flex; align-items:center; justify-content:center;
      box-shadow:0 2px 4px rgba(0,0,0,.25);
    }
    .badge.right svg{ width:100%; height:100%; display:block; }

    .footer{ position:absolute; left:0; right:0; bottom:12px; text-align:center; font-size:12px; color:#3c2a1a; z-index:1; }

    .actions{ position:absolute; top:6px; right:6px; z-index:3; display:flex; gap:6px; }
    .btn-add{ font-size:12px; padding:6px 8px; border-radius:6px; border:1px solid #b9a37f; background:#fff4cf; cursor:pointer; }

    /* --- Hand header --- */
    .handHeader{
      position:sticky; bottom:0; background:rgba(248,240,219,.98); border-top:2px solid #4c2b16;
      box-shadow:0 -6px 16px rgba(0,0,0,.25); padding:10px 12px; display:flex; align-items:center; gap:10px; justify-content:space-between; z-index:10;
    }
    .handTitle{ font-weight:900; font-family:"Copperplate",Georgia,serif; }
    .handControls{ display:flex; gap:8px; align-items:center; }

    /* --- Hand grid (flex wrap to multiple rows) --- */
    .handGrid{
      display:flex; flex-wrap:wrap; justify-content:center; align-items:flex-start;
      gap:16px; padding:12px 12px 18px; background:rgba(246,237,217,.9); border-bottom:2px solid #4c2b16;
    }

    /* --- Hand card tweaks --- */
    .card.hand{ width:220px; box-sizing:border-box; padding:10px 12px 48px; position:relative; flex:0 0 auto; }
    .card.hand .title{ font-size:18px; margin-bottom:6px; }
    .card.hand .badge{ width:34px; height:34px; bottom:6px; }
    .card.hand .footer{ font-size:11px; }

    /* Remove (X) button for hand cards */
    .removeBtn{
      position:absolute; top:6px; right:6px; width:26px; height:26px; border-radius:50%;
      border:1px solid #8b734f; background:#fff0d0; font-weight:900; font-size:16px; color:#3c2a1a;
      display:flex; align-items:center; justify-content:center; line-height:1; cursor:pointer; z-index:4;
    }
    .removeBtn:hover{ background:#ffe6bd; }

    /* --- Confirm Modal --- */
    .modal { position:fixed; inset:0; z-index:1000; display:none; align-items:center; justify-content:center; background:rgba(0,0,0,.45); }
    .modal.show { display:flex; }
    .modalBox{
      width:min(420px, 92vw); background:#f8f0db; border:2px solid #4c2b16; border-radius:10px;
      box-shadow:0 10px 30px rgba(0,0,0,.35); padding:18px 20px; text-align:center; color:#1a0f08;
    }
    .modalTitle{ font-family:"Copperplate",Georgia,serif; font-size:18px; font-weight:900; margin:0 0 6px; }
    .modalMsg{ margin:4px 0 12px; }
    .modalBtns{ display:flex; gap:10px; justify-content:center; }
    .modalBtns button{ padding:8px 16px; cursor:pointer; border-radius:8px; border:1px solid #b9a37f; background:#fff4cf; font-weight:700; }
    .modalBtns button.btnDanger{ background:#e9d2b1; border-color:#a68458; }
    .modalBtns button:focus{ outline:2px solid #8b734f; outline-offset:2px; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Pulp Alley Fortune Card Lookup</h1>
    <div class="bar">
      <input id="q" type="search" placeholder="Search by ID or Name..." />
      <button id="btnSearch">Search</button>
    </div>
    <div id="results" class="cards"></div>
  </div>

  <!-- Sticky hand header + grid -->
  <div class="handHeader">
    <div class="handTitle">Hand: <span id="handCount">0</span></div>
    <div class="handControls">
      <button id="btnClearHand">Clear Hand</button>
    </div>
  </div>
  <div id="hand" class="handGrid"></div>

  <!-- Confirm modal -->
  <div id="confirm" class="modal" role="dialog" aria-modal="true" aria-labelledby="confirmTitle">
    <div class="modalBox">
      <h3 id="confirmTitle" class="modalTitle">Remove card?</h3>
      <p class="modalMsg">This card will be removed from your hand.</p>
      <div class="modalBtns">
        <button id="confirmYes" class="btnDanger">Remove</button>
        <button id="confirmNo">Cancel</button>
      </div>
    </div>
  </div>

  <script>
    const GAS_URL = 'https://script.google.com/macros/s/AKfycbxzfKR_CuPgnn6XNWympqPeMWWcG-zBj7XMPLjFjag5vBtbpgW7gUfpV3ON-vYlUas9lg/exec';

    /* Inline SVG Icon Set (includes enamel coin variants) */
    function iconSVG(name){
      const key = String(name||'').trim().toLowerCase();
      const uid = Math.random().toString(36).slice(2, 8); // unique per call

      switch (key) {
        case 'gear':
          return '<svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg"><g fill="currentColor">'
               + '<path d="M28 6h8l2 6 6 2 6-2 4 7-5 4 1 6 5 4-4 7-6-2-6 2-2 6h-8l-2-6-6-2-6 2-4-7 5-4-1-6-5-4 4-7 6 2 6-2 2-6z"/>'
               + '<circle cx="32" cy="32" r="10" fill="#fff" fill-opacity=".15"/></g></svg>';

        case 'star':
          return '<svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg"><path fill="currentColor" d="M32 6l7.5 15.2 16.8 2.4-12.1 11.8 2.9 16.7L32 44.6 16.9 52.9l2.9-16.7L7.7 23.6 24.5 21z"/></svg>';

        case 'skull':
          return '<svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg">'
               + '<path d="M32 10c9 0 16 6.8 16 15.2 0 5.7-3 8.6-6.8 10.3V40H22.8v-4.5C19 34 16 31 16 25.2 16 16.8 23 10 32 10z" fill="currentColor"/>'
               + '<ellipse cx="26" cy="26" rx="3.5" ry="4.5" fill="#fff" fill-opacity=".1"/>'
               + '<ellipse cx="38" cy="26" rx="3.5" ry="4.5" fill="#fff" fill-opacity=".1"/>'
               + '<path d="M28 30l-2.2 3.2h4.4zM24 36h16v3H24z" fill="#fff" fill-opacity=".15"/></svg>';

        case 'bolt':
          return '<svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg"><path fill="currentColor" d="M38 6 14 36h14l-2 22 26-32H38z"/></svg>';

        case 'book':
          return '<svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg">'
               + '<path d="M10 14c8-3 12-3 20 0v36c-8-3-12-3-20 0V14z" fill="currentColor"/>'
               + '<path d="M54 14c-8-3-12-3-20 0v36c8-3 12-3 20 0V14z" fill="currentColor"/>'
               + '<path d="M30 50c-6-2-10-2-16 0M50 50c-6-2-10-2-16 0" stroke="#fff" stroke-width="2" opacity=".25" fill="none"/></svg>';

        /* “Coin” enamel styles for right badge */
        case 'glass': {
          const gBronze = `gBronzeMag_${uid}`, gEnamel = `gEnamelMag_${uid}`;
          return ''+
            '<svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">'+
            '  <defs>'+
            `    <radialGradient id="${gBronze}" cx="30%" cy="25%" r="80%"><stop offset="0%" stop-color="#e7bf97"/><stop offset="50%" stop-color="#b68459"/><stop offset="100%" stop-color="#744f33"/></radialGradient>`+
            `    <radialGradient id="${gEnamel}" cx="35%" cy="30%" r="75%"><stop offset="0%" stop-color="#ffffff"/><stop offset="100%" stop-color="#f4efe6"/></radialGradient>`+
            '  </defs>'+
            `  <circle cx="32" cy="32" r="31" fill="url(#${gBronze})" />`+
            `  <circle cx="32" cy="32" r="29" fill="url(#${gEnamel})" stroke="#c1b092" stroke-width="1"/>`+
            '  <g stroke="#3c2a1a" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" fill="none">'+
            '    <circle cx="28" cy="28" r="10" />'+
            '    <line x1="35" y1="35" x2="46" y2="46" />'+
            '  </g>'+
            '</svg>';
        }

        case 'lock': {
          const gBronze = `gBronzeLock_${uid}`, gEnamel = `gEnamelLock_${uid}`;
          return ''+
            '<svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">'+
            '  <defs>'+
            `    <radialGradient id="${gBronze}" cx="30%" cy="25%" r="80%"><stop offset="0%" stop-color="#e7bf97"/><stop offset="50%" stop-color="#b68459"/><stop offset="100%" stop-color="#744f33"/></radialGradient>`+
            `    <radialGradient id="${gEnamel}" cx="35%" cy="30%" r="75%"><stop offset="0%" stop-color="#ffffff"/><stop offset="100%" stop-color="#f4efe6"/></radialGradient>`+
            '  </defs>'+
            `  <circle cx="32" cy="32" r="31" fill="url(#${gBronze})" />`+
            `  <circle cx="32" cy="32" r="29" fill="url(#${gEnamel})" stroke="#c1b092" stroke-width="1"/>`+
            '  <g stroke="#3c2a1a" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" fill="none">'+
            '    <path d="M24 30 v-6 a8 8 0 0 1 16 0 v6" />'+
            '    <rect x="22" y="30" width="20" height="16" rx="2" ry="2" fill="#3c2a1a" />'+
            '    <circle cx="32" cy="38" r="2" fill="#f4efe6" stroke="none"/>'+
            '    <line x1="32" y1="40" x2="32" y2="44" stroke="#f4efe6" stroke-width="2"/>'+
            '  </g>'+
            '</svg>';
        }

        default: return '';
      }
    }

	// === Live search via Apps Script JSONP ===
	async function doSearch(page = 1){
	  const q = document.getElementById('q').value.trim();
	  const res = document.getElementById('results');

	  if (!q) { res.innerHTML = '<p>Please enter a search term.</p>'; return; }
	  res.innerHTML = '<p><em>Searching…</em></p>';

	  try {
		const url = `${GAS_URL}?mode=json&q=${encodeURIComponent(q)}&page=${page}&_=${Date.now()}`;
		const payload = await jsonp(url);   // uses the jsonp() helper already in the file

		// Normalize if backend returns objects instead of {headers,rows}
		if (!Array.isArray(payload.headers) || !Array.isArray(payload.rows)) {
		  const list = Array.isArray(payload?.data) ? payload.data : [];
		  const headers = list.length ? Object.keys(list[0]) : [];
		  const rows = list.map(o => headers.map(h => o[h] ?? ''));
		  render({ headers, rows });
		} else {
		  render(payload); // expected shape from your Apps Script
		}
	  } catch (e) {
		console.error(e);
		res.innerHTML = `<p style="color:#900;">Search failed: ${e.message}</p>`;
	  }
	}

	// Wire up UI
	document.getElementById('btnSearch').onclick = () => doSearch(1);
	document.getElementById('q').addEventListener('keydown', e => { if (e.key === 'Enter') doSearch(1); });

	// Optional: auto-search on load (comment out if not wanted)
	// doSearch(1);

    const headers = ["ID","Name","Type","Challenge","Skills","Flavor","Notes","Icon"];
    const rows = [
      ["F-01","Perilous Ruins","Fortune","2 Successes","Finesse • Cunning","“Watch your step…”","—","glass"],
      ["F-02","Rusty Lock","Fortune","3 Successes","Cunning • Might","“Old iron, older secrets.”","—","lock"]
    ];
    document.getElementById('btnSearch').addEventListener('click', () => {
      render({ headers, rows });
    });

    /* ID → Object map for quick lookup (populated in render) */
    let idToObj = {};

    /* Card HTML builder (matches GoogleIndex.html layout) */
/* Card HTML */
function cardHTML(o, opts){
  opts = opts || {};
  var name = o.Name || 'Untitled',
      play = o.Play || '',
      effect = o.Effect || '',
      flavor = o.Flavor || '',
      skills = o.Skills || '',
      id = o.ID || '',
      cardLimit = o.CardLimit || '',
      chall = o.ChallengeValue || '',
      storyIcon = o.StoryIcon || '';

  var html = '<div class="card" data-id="'+escapeAttr(id)+'">'
    + '<div class="corner tl">'+ornSvg()+'</div>'
    + '<div class="corner tr">'+ornSvg()+'</div>'
    + '<div class="corner br">'+ornSvg()+'</div>'
    + '<div class="corner bl">'+ornSvg()+'</div>';

  // "X" remove button when rendering in the Hand
  if (opts.isHand) {
    const uidAttr = opts.uid ? ' data-uid="'+escapeAttr(opts.uid)+'"' : '';
    html += '<button class="removeBtn"'+uidAttr+' data-id="'+escapeAttr(id)+'" title="Remove from hand">×</button>';
  }

  if (opts.showAdd)
    html += '<div class="actions"><button class="btn-add" data-id="'+escapeAttr(id)+'">+ Add to hand</button></div>';

  html += '<div class="title">'+escapeHtml(name)+'</div>';

  if (play) {
    const normalizedPlay = String(play).trim().toLowerCase();
    const mustPlay = normalizedPlay === 'you must play immediately.';
    const playStyle  = mustPlay ? 'color:#a00;font-weight:900;' : '';
    const labelStyle = mustPlay ? 'color:#a00;' : '';
    html += '<div class="row" style="'+playStyle+'"><span class="label" style="'+labelStyle+'">Play:</span> '+nl2br(escapeHtml(play))+'</div>';
  }
  if (effect)
    html += '<div class="row"><span class="label">Effect:</span> '+nl2br(escapeHtml(effect))+'</div>';

  if (flavor) {
    let f = String(flavor).trim();
    if (!/^["“].*["”]$/.test(f)) f = '"'+f+'"';
    html += '<div class="flavor">'+escapeHtml(f)+'</div>';
  }

  html += '<div class="divider">'+skullDividerSepia()+'</div>';
  html += '<div class="challengeHdr">Challenge</div>';

  if (skills)
    html += '<div class="skills">'+escapeHtml(skills)+'</div>';

  html += '<div class="badge left">'+(chall ? escapeHtml(chall) : '—')+'</div>';

  html += renderIconInline(storyIcon); // right badge

  html += '<div class="footer">#'+escapeHtml(id)+'/'+escapeHtml(cardLimit)+' • Pulp Alley © 2025</div>'
       +  '</div>';

  return html;
}
      const showAdd = !!opts.showAdd;
      const icon = iconSVG(o.Icon||'');
      return `
        <div class="card">
          <div class="corner tl">${ornSvg()}</div>
          <div class="corner tr">${ornSvg()}</div>
          <div class="corner br">${ornSvg()}</div>
          <div class="corner bl">${ornSvg()}</div>

          <div class="title">${escapeHtml(o.Name||'')}</div>

          <div class="row"><span class="label">Type:</span> ${escapeHtml(o.Type||'')}</div>
          <div class="divider">${skullDividerSepia()}</div>
          <div class="challengeHdr">${escapeHtml(o.Challenge||'')}</div>
          <div class="skills">${escapeHtml(o.Skills||'')}</div>
          ${o.Flavor ? `<div class="flavor">“${escapeHtml(o.Flavor)}”</div>` : ''}

          <div class="badge left">${escapeHtml((o.ID||'').toString())}</div>
          <div class="badge right">${icon||''}</div>

          <div class="footer">${escapeHtml(o.Notes||'')}</div>

          ${showAdd ? `<div class="actions"><button class="btn-add" data-id="${escapeAttr(o.ID)}">Add to Hand</button></div>` : ``}
        </div>
      `;
    }
// Right badge renderer — supports data-URL images or keyword icons
function renderIconInline(storyIcon){
  const s = String(storyIcon||'').trim();
  if (!s) return '<div class="badge right">'+iconSVG('lock')+'</div>'; // default lock

  // If the sheet stores a data URL image, show it
  if (s.startsWith('data:image')) {
    return '<div class="badge right"><img alt="" src="'+s+'" style="width:100%;height:100%;object-fit:contain"></div>';
  }

  // Otherwise map common names to your inline SVG set
  const key = s.toLowerCase();
  const known = ['lock','glass','gear','star','skull','bolt','book'];
  if (known.includes(key)) {
    return '<div class="badge right">'+iconSVG(key)+'</div>';
  }

  // Fallback: show first letter(s)
  return '<div class="badge right" title="'+escapeAttr(s)+'"'
       + ' style="font-weight:900;font-size:14px;color:#3c2a1a;">'
       + escapeHtml(s.slice(0,2).toUpperCase())
       + '</div>';
}

// Corner ornament SVG (same as your Google page)
function ornSvg(){
  return '<svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg">'
       + '<path fill="#4c2b16" d="M0,0 L64,0 L64,8 C44,8 20,24 8,40 L0,40 Z" opacity=".85"/></svg>';
}

// Divider SVG with three skull tiles
function skullDividerSepia(){
  return '<svg viewBox="0 0 300 36" xmlns="http://www.w3.org/2000/svg">'
       + '<g stroke="#3c2a1a" stroke-width="2" stroke-linecap="round" fill="none">'
       + '<path d="M8 18 H95"/><path d="M205 18 H292"/></g>'
       + '<rect x="110" y="6" width="24" height="24" fill="#2b1a10" stroke="#3c2a1a"/>'
       + '<rect x="138" y="6" width="24" height="24" fill="#2b1a10" stroke="#3c2a1a"/>'
       + '<rect x="166" y="6" width="24" height="24" fill="#2b1a10" stroke="#3c2a1a"/>'
       + '<defs><g id="s">'
       + '<path d="M12,5 c5,0 9,3.5 9,8 c0,3 -1.5,4.5 -3.5,5.4 v2.2 h-11 v-2.2 C4.5,17.5 3,16 3,13 C3,8.5 7,5 12,5 z" fill="#f7f2e3" stroke="#3c2a1a" stroke-width="0.75"/>'
       + '<ellipse cx="9" cy="12" rx="2" ry="2.8" fill="#3c2a1a"/>'
       + '<ellipse cx="15" cy="12" rx="2" ry="2.8" fill="#3c2a1a"/>'
       + '<path d="M12 14 l-1.5 2.2 h3 z" fill="#3c2a1a"/>'
       + '<rect x="8" y="19.2" width="8" height="3.2" rx="0.8" fill="#3c2a1a"/></g></defs>'
       + '<use href="#s" x="110" y="6"/><use href="#s" x="138" y="6"/><use href="#s" x="166" y="6"/></svg>';
}

// Your inline icon set (gear/star/skull/bolt/book/lock/glass…)
function iconSVG(name){ /* keep the implementation you already have */ }

// Text helpers
function escapeHtml(s){
  return String(s)
   .replace(/&/g,'&amp;').replace(/</g,'&lt;')
   .replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#39;');
}
function escapeAttr(s){ return escapeHtml(s).replace(/"/g,'&quot;'); }
function nl2br(s){ return String(s).replace(/\r?\n/g,'<br>'); }

    /* Render results payload (same structure as your GAS page) */
    function render(payload){
      const headers = payload.headers||[], rows = payload.rows||[];
      const resultsEl = document.getElementById('results');
      if(!rows.length){ resultsEl.innerHTML='<p>No cards found.</p>'; return; }
      const objs = rows.map(r => {
        const o = {}; headers.forEach((h,i)=> o[h]=r[i]); return o;
      });
      idToObj = {}; objs.forEach(o => idToObj[o.ID]=o);
      resultsEl.innerHTML = objs.map(o => cardHTML(o,{showAdd:true})).join('');
      // wire add buttons
      resultsEl.querySelectorAll('.btn-add').forEach(btn => {
        btn.addEventListener('click', () => addToHand(btn.getAttribute('data-id')));
      });
    }

    /* Hand management */
    const handEl = document.getElementById('hand');
    const handCountEl = document.getElementById('handCount');

    function addToHand(id){
      const o = idToObj[id];
      if(!o) return;
      const wrapper = document.createElement('div');
      wrapper.innerHTML = cardHTML(o);
      const card = wrapper.firstElementChild;
      card.classList.add('hand');

      // add remove button
      const x = document.createElement('button');
      x.className = 'removeBtn';
      x.setAttribute('aria-label','Remove card');
      x.textContent = '×';
      x.addEventListener('click', () => confirmRemove(card));
      card.appendChild(x);

      handEl.appendChild(card);
      updateHandCount();
    }

    function updateHandCount(){
      handCountEl.textContent = handEl.querySelectorAll('.card.hand').length;
    }

    /* Confirm modal for removals */
    const modal = document.getElementById('confirm');
    const btnYes = document.getElementById('confirmYes');
    const btnNo = document.getElementById('confirmNo');
    let pendingRemove = null;

    function confirmRemove(card){
      pendingRemove = card;
      modal.classList.add('show');
      btnYes.onclick = () => { if(pendingRemove){ pendingRemove.remove(); updateHandCount(); } closeModal(); };
      btnNo.onclick  = closeModal;
      modal.addEventListener('click', (e)=> { if(e.target===modal) closeModal(); }, { once:true });
      window.addEventListener('keydown', escClose, { once:true });
    }
    function escClose(e){ if(e.key==='Escape') closeModal(); }
    function closeModal(){ modal.classList.remove('show'); pendingRemove=null; }

    /* Utilities */
    function escapeHtml(s){ return String(s||'')
      .replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;')
      .replace(/"/g,'&quot;').replace(/'/g,'&#39;'); }
    function escapeAttr(s){ return escapeHtml(s).replace(/"/g,'&quot;'); }

    /* Clear hand */
    document.getElementById('btnClearHand').addEventListener('click', () => {
      if(!handEl.firstChild) return;
      // use the same modal for consistency
      pendingRemove = 'ALL';
      document.getElementById('confirmTitle').textContent = 'Clear entire hand?';
      document.querySelector('#confirm .modalMsg').textContent = 'All cards will be removed from your hand.';
      modal.classList.add('show');
      btnYes.onclick = () => { handEl.innerHTML=''; updateHandCount(); resetConfirmCopy(); closeModal(); };
      btnNo.onclick  = () => { resetConfirmCopy(); closeModal(); };
      function resetConfirmCopy(){
        document.getElementById('confirmTitle').textContent = 'Remove card?';
        document.querySelector('#confirm .modalMsg').textContent = 'This card will be removed from your hand.';
      }
      modal.addEventListener('click', (e)=> { if(e.target===modal){ resetConfirmCopy(); closeModal(); } }, { once:true });
      window.addEventListener('keydown', (e)=>{ if(e.key==='Escape'){ resetConfirmCopy(); closeModal(); } }, { once:true });
    });

    /* Optional: auto-demo load */
    render({ headers, rows });
  </script>
</body>
</html>
